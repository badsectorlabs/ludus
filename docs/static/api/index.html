<!doctype html>
<html>
  <head>
    <title>API Reference</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
    <style>
      body {
        margin: 0;
      }
    </style>
  </head>
  <body>
    <script
        id="api-reference"
        type="application/json">
        {
          "openapi" : "3.0.3",
          "info" : {
            "description" : "This API controls Ludus user management, range deployment, power state, and testing state.",
            "version" : "1.0.0",
            "title" : "Ludus API",
            "license" : {
              "name" : "AGPLv3",
              "url" : "https://www.gnu.org/licenses/agpl-3.0.en.html"
            }
          },
          "externalDocs" : {
            "description" : "Find out more about Ludus",
            "url" : "https://gitlab.com/badsectorlabs/ludus"
          },
          "security" : [ {
            "ApiKeyAuth" : [ ]
          } ],
          "tags" : [ {
            "name" : "User Management",
            "description" : "Actions to list and manage user accounts in Ludus and the underlying operating system"
          }, {
            "name" : "Range Management",
            "description" : "Actions to list and manage range deployment"
          }, {
            "name" : "Power State Management",
            "description" : "Actions to list VM power state and toggle VM power state"
          }, {
            "name" : "Testing State Management",
            "description" : "Actions to show range testing state and toggle range testing state"
          }, {
            "name" : "Host Management",
            "description" : "Actions to manage the ludus host"
          }, {
            "name" : "Ansible Management",
            "description" : "Actions to manage Ansible roles and collections on the ludus host"
          } ],
          "paths" : {
            "/" : {
              "get" : {
                "tags" : [ "Host Management" ],
                "summary" : "Retrieve the ludus version",
                "operationId" : "index",
                "description" : "Returns the ludus version\n",
                "responses" : {
                  "200" : {
                    "description" : "index",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "Ludus Server v1.0.0+abc123a"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/ansible" : {
              "get" : {
                "tags" : [ "Ansible Management" ],
                "summary" : "Retrieve available Ansible roles and collections",
                "operationId" : "getRolesAndCollections",
                "description" : "Returns available Ansible roles installed for this\nuser on the ludus host\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to get roles and collections for a specific user",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "responses" : {
                  "200" : {
                    "description" : "Available roles and collections",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "array",
                          "items" : {
                            "type" : "object",
                            "properties" : {
                              "name" : {
                                "type" : "string",
                                "example" : "geerlingguy.java"
                              },
                              "version" : {
                                "type" : "string",
                                "example" : "2.3.2"
                              },
                              "type" : {
                                "type" : "string",
                                "example" : "role"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/ansible/role" : {
              "post" : {
                "tags" : [ "Ansible Management" ],
                "summary" : "Install or Remove an Ansible role",
                "operationId" : "InstallRole",
                "description" : "Install or Remove an ansible role by name or URL.\nAdmins can pass a userID parameter to install a role for other users\nAction can be either \"install or \"remove\".\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to install for. \nDefaults to the user's range (admins can interact with other users' ranges)\n",
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "requestBody" : {
                  "content" : {
                    "application/json" : {
                      "schema" : {
                        "properties" : {
                          "role" : {
                            "type" : "string",
                            "example" : "geerlingguy.java"
                          },
                          "version" : {
                            "type" : "string",
                            "example" : "2.3.2"
                          },
                          "force" : {
                            "type" : "boolean",
                            "example" : true
                          },
                          "action" : {
                            "type" : "string",
                            "example" : "install"
                          }
                        }
                      }
                    }
                  }
                },
                "responses" : {
                  "201" : {
                    "description" : "role installed",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "Successfully installed: geerlingguy.java"
                            }
                          }
                        }
                      }
                    }
                  },
                  "409" : {
                    "description" : "Role not installed",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "error" : {
                              "type" : "string",
                              "example" : "- geerlingguy.docker is not installed, skipping."
                            }
                          }
                        }
                      }
                    }
                  },
                  "500" : {
                    "description" : "Error installing role",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "error" : {
                              "type" : "string",
                              "example" : "Unable to install the ansible role: geerlingguy.java"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/ansible/role/fromtar" : {
              "put" : {
                "tags" : [ "Ansible Management" ],
                "summary" : "Install an Ansible role from local directory",
                "operationId" : "InstallRoleTar",
                "description" : "Install an ansible role from a local directory.\nAdmins can pass a userID parameter to install a role for other users.\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to install for. \nDefaults to the user's range (admins can interact with other users' ranges)\n",
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "requestBody" : {
                  "content" : {
                    "multipart/form-data" : {
                      "schema" : {
                        "type" : "object",
                        "properties" : {
                          "file" : {
                            "type" : "string",
                            "format" : "binary"
                          },
                          "force" : {
                            "type" : "boolean",
                            "example" : false
                          }
                        }
                      }
                    }
                  }
                },
                "responses" : {
                  "201" : {
                    "description" : "role installed",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "Successfully installed role"
                            }
                          }
                        }
                      }
                    }
                  },
                  "400" : {
                    "description" : "Error installing role - bad request",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "error" : {
                              "type" : "string",
                              "example" : "Invalid boolean value"
                            }
                          }
                        }
                      }
                    }
                  },
                  "500" : {
                    "description" : "Error installing role - server error",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "error" : {
                              "type" : "string",
                              "example" : "Unable to install the ansible role: <error>"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/ansible/collection" : {
              "post" : {
                "tags" : [ "Ansible Management" ],
                "summary" : "Install an Ansible collection",
                "operationId" : "InstallCollection",
                "description" : "Install an ansible collection by name or URL.\nAdmins can pass a userID parameter to install a collection for other users.\nAnsible collections can only be removed by rm-ing their directories. This is not supported via Ludus due to potential edge cases in naming depending on how the collection was installed.\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to install for. \nDefaults to the user's range (admins can interact with other users' ranges)\n",
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "requestBody" : {
                  "content" : {
                    "application/json" : {
                      "schema" : {
                        "properties" : {
                          "collection" : {
                            "type" : "string",
                            "example" : "maxhoesel.smallstep"
                          },
                          "version" : {
                            "type" : "string",
                            "example" : "0.23.1"
                          },
                          "force" : {
                            "type" : "boolean",
                            "example" : true
                          }
                        }
                      }
                    }
                  }
                },
                "responses" : {
                  "201" : {
                    "description" : "collection installed",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "Successfully installed: maxhoesel.smallstep"
                            }
                          }
                        }
                      }
                    }
                  },
                  "409" : {
                    "description" : "Collection already installed",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "error" : {
                              "type" : "string",
                              "example" : "Collection already installed. Collections from https://docs.ansible.com/ansible/latest/collections/index.html are installed globally. If you want to reinstall it, consider using `--force`."
                            }
                          }
                        }
                      }
                    }
                  },
                  "500" : {
                    "description" : "Error installing collection",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "error" : {
                              "type" : "string",
                              "example" : "Unable to install the ansible collection: maxhoesel.smallstep"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/user" : {
              "get" : {
                "tags" : [ "User Management" ],
                "summary" : "List user details",
                "operationId" : "listUser",
                "description" : "By passing in the appropriate options, you can search for\navailable users in Ludus\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to reset a specific user",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "responses" : {
                  "200" : {
                    "description" : "search results matching criteria",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "array",
                          "items" : {
                            "$ref" : "#/components/schemas/UserObject"
                          }
                        }
                      }
                    }
                  },
                  "400" : {
                    "description" : "bad input parameter"
                  }
                }
              },
              "post" : {
                "tags" : [ "User Management" ],
                "summary" : "Add a user to the system",
                "operationId" : "addUser",
                "description" : "Adds a user to the system. This action is only available to admins. \nNote: this response will contain the plaintext API key for the user. \nIt will not be available again except by resetting it using the /user/apikey endpoint.\n",
                "responses" : {
                  "201" : {
                    "description" : "user created",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "allOf" : [ {
                            "$ref" : "#/components/schemas/UserObject"
                          }, {
                            "type" : "object",
                            "properties" : {
                              "apiKey" : {
                                "type" : "string",
                                "example" : "JD.Vf{M@GC:w}YQ=1zv@gLLnDH:j3nI]l7@:ct:qPy9"
                              }
                            }
                          }, {
                            "type" : "object",
                            "properties" : {
                              "proxmoxUsername" : {
                                "type" : "string",
                                "example" : "john-doe"
                              }
                            }
                          } ]
                        }
                      }
                    }
                  },
                  "400" : {
                    "description" : "Error with request",
                    "example": "User with that name already exists"
                  }
                },
                "requestBody" : {
                  "content" : {
                    "application/json" : {
                      "schema" : {
                        "$ref" : "#/components/schemas/UserObject"
                      }
                    }
                  },
                  "description" : "User to add"
                }
              }
            },
            "/user/{userID}" : {
              "delete" : {
                "tags" : [ "User Management" ],
                "summary" : "Remove a user from the system",
                "operationId" : "deleteUser",
                "description" : "Removes a user from the system. This action is only available to admins.\n",
                "parameters" : [ {
                  "name" : "userID",
                  "in" : "path",
                  "required" : true,
                  "description" : "The id of the users to delete",
                  "schema" : {
                    "$ref" : "#/components/schemas/userID"
                  }
                } ],
                "responses" : {
                  "200" : {
                    "description" : "user deleted"
                  },
                  "400" : {
                    "description" : "userID not provided"
                  },
                  "404" : {
                    "description" : "user not found"
                  }
                }
              }
            },
            "/user/passwordreset" : {
              "post" : {
                "tags" : [ "User Management" ],
                "summary" : "Reset a user's proxmox password",
                "operationId" : "passwordReset",
                "description" : "Resets a user's proxmox password.\nThis action is only available to admins.\n",
                "responses" : {
                  "201" : {
                    "description" : "user credentials updated"
                  },
                  "400" : {
                    "description" : "invalid input, object invalid"
                  }
                },
                "requestBody" : {
                  "content" : {
                    "application/json" : {
                      "schema" : {
                        "properties" : {
                          "userID" : {
                            "$ref" : "#/components/schemas/userID"
                          }
                        }
                      }
                    }
                  },
                  "description" : "User to add"
                }
              }
            },
            "/user/credentials" : {
              "get" : {
                "description" : "Get proxmox credentials for a user\n",
                "operationId" : "getCredentials",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to reset a specific user",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "responses" : {
                  "200" : {
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "$ref" : "#/components/schemas/UserCredentialObject"
                            }
                          }
                        }
                      }
                    },
                    "description" : "proxmox credentials for the user"
                  },
                  "400" : {
                    "description" : "bad input parameter"
                  }
                },
                "summary" : "Get proxmox creds for a user",
                "tags" : [ "User Management" ]
              },
              "post" : {
                "description" : "Set the proxmox password for a user. userID is optional and only can be set\nto other user's userIDs by admins.\n",
                "operationId" : "postCredentials",
                "requestBody" : {
                  "content" : {
                    "application/json" : {
                      "schema" : {
                        "properties" : {
                          "userID" : {
                            "$ref" : "#/components/schemas/userID"
                          },
                          "proxmoxPassword" : {
                            "type" : "string",
                            "example" : "5cy5@plhik4g&Yk12sG"
                          }
                        }
                      }
                    }
                  }
                },
                "responses" : {
                  "200" : {
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "Your proxmox password has been successfully updated."
                            }
                          }
                        }
                      }
                    },
                    "description" : "proxmox credentials for the user"
                  },
                  "400" : {
                    "description" : "bad input parameter"
                  }
                },
                "summary" : "Set the proxmox creds for the user",
                "tags" : [ "User Management" ]
              }
            },
            "/user/apikey" : {
              "get" : {
                "tags" : [ "User Management" ],
                "summary" : "Reset and retrieve the Ludus API key for a user",
                "operationId" : "getAPIKey",
                "description" : "Reset and return the API key for the user specified in the query (admins only)\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to reset a specific user",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "responses" : {
                  "200" : {
                    "description" : "Ludus API key for the user",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "$ref" : "#/components/schemas/UserAPIKeyObject"
                            }
                          }
                        }
                      }
                    }
                  },
                  "400" : {
                    "description" : "bad input parameter"
                  }
                }
              }
            },
            "/user/all" : {
              "get" : {
                "tags" : [ "User Management" ],
                "summary" : "List all users",
                "operationId" : "listAllUsers",
                "description" : "Get all users in Ludus. Available only to admins\n",
                "responses" : {
                  "200" : {
                    "description" : "search results matching criteria",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "array",
                          "items" : {
                            "$ref" : "#/components/schemas/UserObject"
                          }
                        }
                      }
                    }
                  },
                  "400" : {
                    "description" : "bad input parameter"
                  }
                }
              }
            },
            "/user/wireguard" : {
              "get" : {
                "tags" : [ "User Management" ],
                "summary" : "Retrieve a WireGuard configuration file for a user",
                "operationId" : "getWireguardConfig",
                "description" : "Returns a WireGuard configuration file with appropriate\nvalues for the user's range\n\n\"WireGuard\" is the registered trademark of Jason A. Donenfeld. \n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to reset a specific user",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "responses" : {
                  "200" : {
                    "description" : "a user's WireGuard configuration file",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "object",
                              "properties" : {
                                "wireGuardConfig" : {
                                  "type" : "object",
                                  "example" : "[Interface]\nPrivateKey = UJrxTNT4gkGQoJiltyjkC+Wi6m/VnY7YetjOYTjAWmc=\nAddress = 198.51.100.3/32\n\n[Peer]\nPublicKey = CHxW+36fC1g/cnBoSGGI0Shh/yMgbE9YgjC8p9zZnXw=\nAllowedIPs = 10.3.0.0/16, 198.51.100.1/32\nEndpoint = 198.18.0.25:51820\nPersistentKeepalive = 25\n"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/range" : {
              "get" : {
                "tags" : [ "Range Management" ],
                "summary" : "List range VMs, power state, and testing state",
                "operationId" : "listRange",
                "description" : "Lists a range's VMs along with their power state and the testing state\nof the range. Admins can use the query parameter userID to inspect\nother users' ranges.\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to query. \nDefaults to the user's range (admins can query other ranges)\n",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "responses" : {
                  "200" : {
                    "description" : "search results matching criteria",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "$ref" : "#/components/schemas/RangeObject"
                        }
                      }
                    }
                  },
                  "400" : {
                    "description" : "bad input parameter"
                  }
                }
              },
              "delete" : {
                "tags" : [ "Range Management" ],
                "summary" : "Stop and delete all range VMs",
                "operationId" : "deleteRange",
                "description" : "Stops and deletes all the range VMs. Used to start fresh.",
                "parameters" : [ {
                  "name" : "userID",
                  "in" : "query",
                  "required" : false,
                  "description" : "The id of the range to tear down (default: the calling user)",
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "responses" : {
                  "201" : {
                    "description" : "Range destroy in progress",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "Range destroy in progress"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/range/abort" : {
              "post" : {
                "tags" : [ "Range Management" ],
                "summary" : "Stop the range deployment ansible process",
                "operationId" : "abortRange",
                "description" : "Stops the range deployment by finding the pid of the ansible\nprocess for the user and killing it. Admins may call this and \nspecify another user ID.\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to query. \nDefaults to the user's range (admins can query other ranges)\n",
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  },
                  "required" : false
                } ],
                "responses" : {
                  "201" : {
                    "description" : "range deploy aborted"
                  },
                  "400" : {
                    "description" : "invalid input, object invalid"
                  },
                  "500" : {
                    "description" : "error with abort"
                  }
                }
              }
            },
            "/range/tags" : {
              "get" : {
                "tags" : [ "Range Management" ],
                "summary" : "List all tags available to use with deploy",
                "operationId" : "listRangeTags",
                "description" : "List all the ansible tags a user can specify with the deploy command\n",
                "responses" : {
                  "200" : {
                    "description" : "available tags",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "string",
                          "example" : "additional-tools, custom-choco, custom-tasks, dcs, debug, destroy-range, domain-join, etchosts, host-payload, install-office, install-visual-studio, nexus, opstations, redirectors, services, teamservers, test-range, user-management, win10, winrunner"
                        }
                      }
                    }
                  },
                  "400" : {
                    "description" : "bad input parameter"
                  }
                }
              }
            },
            "/range/all" : {
              "get" : {
                "tags" : [ "Range Management" ],
                "summary" : "List summary information for all ranges",
                "operationId" : "listAllRange",
                "description" : "Lists all range's VMs along with their power state and the testing state\nof the range. This endpoint is only available to admins.\n",
                "responses" : {
                  "200" : {
                    "description" : "search results matching criteria",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "array",
                          "items" : {
                            "$ref" : "#/components/schemas/RangeObject"
                          }
                        }
                      }
                    }
                  },
                  "400" : {
                    "description" : "bad input parameter"
                  }
                }
              }
            },
            "/range/config" : {
              "get" : {
                "tags" : [ "Range Management" ],
                "summary" : "Retrieve range configuration",
                "operationId" : "getConfig",
                "description" : "Returns the current configuration for the range\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to get the config for. \nDefaults to the user's range (admins can query other ranges)\n",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "responses" : {
                  "200" : {
                    "description" : "search results matching criteria",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "example" : "ludus:\n  - vm_name: \"JD-ad-dc-win2019-server-x64\"\n    hostname: \"JD-DC01-2019\"\n    template: win2019-server-x64-template\n    ip_last_octet: 11\n    ram_gb: 2 \n     cpus: 2\n    full_clone: false\n    windows:\n     - vm_name: \"JD-ad-win10-21h1-enterprise-x64-1\"\n    hostname: \"JE-WIN10-21H1-1\"\n    template: win10-21h1-x64-enterprise-template\n    ip_last_octet: 21\n    ram_gb: 2 \n    cpus: 2\n    full_clone: false\n    windows:\n      install_additional_tools: true\n      office_version: 2016\n      office_arch: 64bit\n  - vm_name: \"JD-ad-win10-21h1-enterprise-x64-2\"\n    hostname: \"JD-WIN10-21H1-2\"\n    template: win10-21h1-x64-enterprise-template\n    ip_last_octet: 22\n    ram_gb: 2 \n    cpus: 2\n    full_clone: false \n    windows:\n      install_additional_tools: true \n      office_version: \"2019\"\n      office_arch: 64bit\n  - vm_name: \"JD-ad-win10-21h1-enterprise-x64-3\"\n    hostname: \"JD-WIN10-21H1-3\"\n    template: win10-21h1-x64-enterprise-template\n    ip_last_octet: 23\n    ram_gb: 2 \n    ram_max_gb: 4\n    ram_balloon: true\n    cpus: 2\n    full_clone: false\n    windows:\n      install_additional_tools: true \n      office_version: \"2019\"\n      office_arch: 64bit\n      visual_studio_version: \"2019\"\n"
                            }
                          }
                        }
                      }
                    }
                  },
                  "400" : {
                    "description" : "bad input parameter"
                  }
                }
              },
              "put" : {
                "tags" : [ "Range Management" ],
                "summary" : "Update the range configuration",
                "operationId" : "putConfig",
                "description" : "Updates the range configuration with the provided yaml file\n",
                "requestBody" : {
                  "content" : {
                    "multipart/form-data" : {
                      "schema" : {
                        "type" : "object",
                        "properties" : {
                          "file" : {
                            "type" : "string",
                            "format" : "binary"
                          }
                        }
                      }
                    }
                  }
                },
                "responses" : {
                  "200" : {
                    "description" : "successfully updated configuration"
                  },
                  "400" : {
                    "description" : "bad input parameter"
                  }
                }
              }
            },
            "/range/config/example" : {
              "get" : {
                "tags" : [ "Range Management" ],
                "summary" : "Retrieve an example range configuration",
                "operationId" : "getConfigExample",
                "description" : "Returns an example configuration for the range with the user's\nuserID in vm_name and hostname fields\n",
                "responses" : {
                  "200" : {
                    "description" : "an example range configuration",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "example" : "network:\n  inter_vlan_default: REJECT\n  rules:\n    - name: Only allow windows to kali on 443\n      vlan_src: 10\n      vlan_dst: 99\n      protocol: tcp\n      ports: 443\n      action: ACCEPT\n    - name: Allow kali to all windows\n      vlan_src: 99\n      vlan_dst: 10\n      protocol: all\n      ports: all\n      action: ACCEPT\n\nludus:\n  - vm_name: \"{{ range_id }}-ad-dc-win2019-server-x64\"\n    hostname: \"{{ range_id }}-DC01-2019\"\n    template: win2019-server-x64-template\n    vlan: 10\n    ip_last_octet: 11\n    ram_gb: 8\n    cpus: 4\n    windows:\n      sysprep: false\n    domain:\n      fqdn: ludus.domain\n      role: primary-dc\n...\n"
                            }
                          }
                        }
                      }
                    }
                  },
                  "400" : {
                    "description" : "bad input parameter"
                  }
                }
              }
            },
            "/range/deploy" : {
              "post" : {
                "tags" : [ "Range Management" ],
                "summary" : "Deploy the range",
                "operationId" : "deployRange",
                "description" : "Deploys a range with ansible. This can be called multiple times\nwithout issue without changing the range configuration without causing\nissues. The tags value is optional, by default \"all\" is run. The force\nvalue is optional, by default it is false.\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to query. \nDefaults to the user's range (admins can query other ranges)\n",
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "requestBody" : {
                  "content" : {
                    "application/json" : {
                      "schema" : {
                        "type" : "object",
                        "properties" : {
                          "tags" : {
                            "type" : "string",
                            "example" : "all",
                            "description" : "the ansible tags to run for this deploy (default: all)"
                          },
                          "force" : {
                            "type" : "boolean",
                            "example" : false,
                            "description" : "force the deployment if testing is enabled (default: false)"
                          },
                          "only_roles" : {
                            "type" : "array",
                            "items" : {
                              "type" : "string",
                              "example": "badsectorlabs.ludus_bloodhound_ce"
                            },
                            "description" : "limit the user defined roles to be run to this comma separated list of roles"
                          }
                        }
                      }
                    }
                  },
                  "description" : "Range to deploy"
                },
                "responses" : {
                  "201" : {
                    "description" : "range deployed"
                  },
                  "400" : {
                    "description" : "invalid input, object invalid"
                  },
                  "500" : {
                    "description" : "error with range deployment"
                  }
                }
              }
            },
            "/range/logs" : {
              "get" : {
                "tags" : [ "Range Management" ],
                "summary" : "Retrieve the latest range logs",
                "operationId" : "getLogs",
                "description" : "Returns the latest logs for the range\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to get the logs for. \nDefaults to the user's range (admins can query other ranges)\n",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                }, {
                  "in" : "query",
                  "name" : "tail",
                  "description" : "pass an optional number of lines to get\n",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "tail" : {
                        "type" : "integer",
                        "example" : 100
                      }
                    }
                  }
                }, {
                  "in" : "query",
                  "name" : "cursor",
                  "description" : "the line number of the last line presented to the user;\nreturn lines starting at the next line (if any)\n",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "resumeline" : {
                        "type" : "integer",
                        "example" : 274
                      }
                    }
                  }
                } ],
                "responses" : {
                  "200" : {
                    "description" : "ansible logs for the user and a cursor value of the last line returned",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "2022-12-06 16:11:11,810 p=2034571 u=john-doe n=ansible | PLAY [Acquire a session ticket for proxmox API] *****\n2022-12-06 16:11:11,818 p=2034571 u=john-doe n=ansible | TASK [Gathering Facts] ******************************\n2022-12-06 16:11:17,284 p=2034571 u=john-doe n=ansible | ok: [localhost] *************************************\n2022-12-06 16:11:17,517 p=2034571 u=john-doe n=ansible | TASK [Acquire session ticket] ***********************\n2022-12-06 16:11:18,028 p=2034571 u=john-doe n=ansible | changed: [localhost] ********************************\n2022-12-06 16:11:18,282 p=2034571 u=john-doe n=ansible | PLAY [Valdation] ************************************\n2022-12-06 16:11:18,628 p=2034571 u=john-doe n=ansible | PLAY [Set up a router VM] ***************************\n2022-12-06 16:11:19,005 p=2034571 u=john-doe n=ansible | PLAY [Configure router] *****************************\n2022-12-06 16:11:19,017 p=2034571 u=john-doe n=ansible | PLAY [Deploy test range DC VMs] *********************\n...\n"
                            },
                            "cursor" : {
                              "type" : "integer",
                              "example" : 274
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/range/etchosts" : {
              "get" : {
                "tags" : [ "Range Management" ],
                "summary" : "Retrieve /etc/hosts file for the range",
                "operationId" : "getEtcHosts",
                "description" : "Returns an /etc/hosts file with appropriate values for the user's range\n",
                "responses" : {
                  "200" : {
                    "description" : "a range /etc/hosts file",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "# Ludus /etc/hosts\n10.3.10.13     JD-ad-dc-win2012r2-server-x64\n10.3.10.13     ad-dc-win2012r2-server-x64\n10.3.10.12     JD-ad-dc-win2016-server-x64\n10.3.10.12     ad-dc-win2016-server-x64\n10.3.10.11     JD-ad-dc-win2019-server-x64\n10.3.10.11     ad-dc-win2019-server-x64\n10.3.10.21     JD-ad-win10-21h1-enterprise-x64-1\n10.3.10.21     ad-win10-21h1-enterprise-x64-1\n10.3.10.22     JD-ad-win10-21h1-enterprise-x64-2\n10.3.10.22     ad-win10-21h1-enterprise-x64-2\n10.3.10.23     JD-ad-win10-21h1-enterprise-x64-3\n10.3.10.23     ad-win10-21h1-enterprise-x64-3\n10.3.50.10     JD-gitlab\n10.3.50.10     gitlab\n10.3.40.11     JD-kali1\n10.3.40.11     kali1\n10.3.10.157    JD-macOS-test\n10.3.10.157    macOS-test\n10.3.50.11     JD-mattermost\n10.3.50.11     meet.JE-mattermost\n10.3.50.11     mattermost\n10.3.50.13     JD-nextcloud\n10.3.50.13     nextcloud\n10.3.50.12     JD-redelk\n10.3.50.12     redelk\n10.3.30.11     JD-teamserver1\n10.3.30.11     teamserver1\n10.3.30.12     JD-teamserver2\n10.3.30.12     teamserver2\n10.3.30.13     JD-teamserver3\n10.3.30.13     teamserver3\n10.3.50.14     JD-winrunner\n10.3.50.14     winrunner\n10.3.50.254    ca\n"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/range/sshconfig" : {
              "get" : {
                "tags" : [ "Range Management" ],
                "summary" : "Retrieve a ssh config",
                "operationId" : "getSSHConfig",
                "description" : "Returns a ssh configuration file with appropriate values for the user's range\n",
                "responses" : {
                  "200" : {
                    "description" : "a range SSH configuration file",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "Host teamserver1\n  HostName 10.3.30.11\n  User debian\n  Port 22\n  IdentityFile ~/.ssh/ludus.key\n  \nHost teamserver2\n  HostName 10.3.30.12\n  User debian\n  Port 22\n  IdentityFile ~/.ssh/ludus.key\n"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/range/rdpconfigs" : {
              "get" : {
                "tags" : [ "Range Management" ],
                "summary" : "Retrieve a zip file of RDP configs",
                "operationId" : "getRDP",
                "description" : "Returns a zip file with RDP configuration files for the Windows\nVMs in a user's range\n",
                "responses" : {
                  "200" : {
                    "description" : "a zip file",
                    "content" : {
                      "application/zip" : {
                        "example" : "rdp.zip"
                      }
                    }
                  }
                }
              }
            },
            "/range/ansibleinventory" : {
              "get" : {
                "tags" : [ "Range Management" ],
                "summary" : "Retrieve an ansible inventory",
                "operationId" : "getAnsibleInventory",
                "description" : "Returns an ansible inventory file with appropriate values for the user's range\n",
                "responses" : {
                  "200" : {
                    "description" : "an ansible inventory file",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "all:\n  children:\n    ADMIN:\n      hosts:\n    JD:\n      hosts:\n        JD-ad-dc-win2019-server-x64:\n          ansible_connection: winrm\n          ansible_host: 10.2.10.11\n          ansible_password: password\n          ansible_user: localuser\n          ansible_winrm_scheme: https            \n"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/range/poweron" : {
              "put" : {
                "tags" : [ "Power State Management" ],
                "summary" : "Power on range VMs",
                "operationId" : "powerOnRange",
                "description" : "Power on one, multiple, or all range VMs.\npassing the machine parameter \"all\" will operate on all VMs in the user's range.\nAdmins can pass a userID parameter to control other user's ranges.\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to query. \nDefaults to the user's range (admins can interact with other users' ranges)\n",
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "requestBody" : {
                  "content" : {
                    "application/json" : {
                      "schema" : {
                        "properties" : {
                          "machines" : {
                            "type" : "array",
                            "items" : {
                              "type" : "string",
                              "example" : "JD-ad-dc-win2019-server-x64"
                            }
                          }
                        }
                      }
                    }
                  },
                  "description" : "Range to power on"
                },
                "responses" : {
                  "201" : {
                    "description" : "range VM(s) powered on",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "range VM power on in progress"
                            }
                          }
                        }
                      }
                    }
                  },
                  "500" : {
                    "description" : "error with range VM power on"
                  }
                }
              }
            },
            "/range/poweroff" : {
              "put" : {
                "tags" : [ "Power State Management" ],
                "summary" : "Power off range VMs",
                "operationId" : "powerOffRange",
                "description" : "Power off one, multiple, or all range VMs.\nPassing the machine parameter \"all\" will operate on all VMs in the user's range.\nAdmins can pass a userID parameter to control other user's ranges.\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to query. \nDefaults to the user's range (admins can interact with other users' ranges)\n",
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "requestBody" : {
                  "content" : {
                    "application/json" : {
                      "schema" : {
                        "properties" : {
                          "machines" : {
                            "type" : "array",
                            "items" : {
                              "type" : "string",
                              "example" : "JD-ad-dc-win2019-server-x64"
                            }
                          }
                        }
                      }
                    }
                  },
                  "description" : "Range to power off"
                },
                "responses" : {
                  "201" : {
                    "description" : "range VM(s) powered off",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "range VM power off in progress"
                            }
                          }
                        }
                      }
                    }
                  },
                  "500" : {
                    "description" : "error with range VM power off"
                  }
                }
              }
            },
            "/testing/start" : {
              "put" : {
                "tags" : [ "Testing State Management" ],
                "summary" : "Snapshot and enter testing state",
                "operationId" : "startTesting",
                "description" : "Uses ansible to snapshot all test_range VMs and block all outbound\ntraffic and DNS requests from the test range subnet.\nAdmins can pass a userID parameter to control other user's ranges.\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to get the start testing for. \nDefaults to the user's range (admins can start testing on other ranges)\n",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "responses" : {
                  "201" : {
                    "description" : "testing state entered"
                  },
                  "400" : {
                    "description" : "invalid input, object invalid"
                  },
                  "500" : {
                    "description" : "error with testing start"
                  }
                }
              }
            },
            "/testing/stop" : {
              "put" : {
                "tags" : [ "Testing State Management" ],
                "summary" : "Revert and exit testing state",
                "operationId" : "stopTesting",
                "description" : "Uses ansible to revet all test_range VMs and allow all outbound\ntraffic and DNS requests from the test range subnet.\nAdmins can pass a userID parameter to control other user's ranges.\nThe force parameter will ignore errors when reverting snapshots.\nSetting force to true may leak telemetry or other data about your\npayloads.\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to get the stop testing for. \nDefaults to the user's range (admins can stop testing on other ranges)\n",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "requestBody" : {
                  "content" : {
                    "application/json" : {
                      "schema" : {
                        "properties" : {
                          "force" : {
                            "type" : "boolean",
                            "example" : false
                          }
                        }
                      }
                    }
                  },
                  "description" : "Range to stop testing"
                },
                "responses" : {
                  "201" : {
                    "description" : "testing state exited"
                  },
                  "400" : {
                    "description" : "invalid input, object invalid"
                  },
                  "500" : {
                    "description" : "error with testing stop"
                  }
                }
              }
            },
            "/testing/allow" : {
              "post" : {
                "tags" : [ "Testing State Management" ],
                "summary" : "Allow a domain",
                "operationId" : "allow",
                "description" : "Looks up the domain and its HTTPS certificate CRL domains adding all the\nIPs to iptables allow as well as to a DNS allow list.\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to act on behalf of. Only admins can provide userIDs that are not their own.\n",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "requestBody" : {
                  "content" : {
                    "application/json" : {
                      "schema" : {
                        "$ref" : "#/components/schemas/AllowPayload"
                      }
                    }
                  },
                  "description" : "domains or ips to allow"
                },
                "responses" : {
                  "200" : {
                    "description" : "domains or ips allowed",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "allowed" : {
                              "type" : "array",
                              "items" : {
                                "type" : "string",
                                "example" : "203.0.113.4"
                              }
                            },
                            "errors" : {
                              "type" : "array",
                              "items" : {
                                "type" : "object",
                                "properties" : {
                                  "item" : {
                                    "type" : "string",
                                    "example" : "example.com"
                                  },
                                  "reason" : {
                                    "type" : "string",
                                    "example" : "already allowed"
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "400" : {
                    "description" : "invalid input, object invalid"
                  },
                  "500" : {
                    "description" : "error with allowing domains or ips"
                  }
                }
              }
            },
            "/testing/deny" : {
              "post" : {
                "tags" : [ "Testing State Management" ],
                "summary" : "Deny a domain",
                "operationId" : "deny",
                "description" : "Removes iptables and DNS rules that allow a domain/ip\nthrough the firewall. Note that this does NOT deny CRL\ndomains as they may be shared my multiple domains.\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to act on behalf of. Only admins can provide userIDs that are not their own.\n",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "requestBody" : {
                  "content" : {
                    "application/json" : {
                      "schema" : {
                        "$ref" : "#/components/schemas/AllowPayload"
                      }
                    }
                  },
                  "description" : "domains or ips to deny"
                },
                "responses" : {
                  "200" : {
                    "description" : "domains or ips denied",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "denied" : {
                              "type" : "array",
                              "items" : {
                                "type" : "string",
                                "example" : "203.0.113.4"
                              }
                            },
                            "errors" : {
                              "type" : "array",
                              "items" : {
                                "type" : "object",
                                "properties" : {
                                  "item" : {
                                    "type" : "string",
                                    "example" : "example.com"
                                  },
                                  "reason" : {
                                    "type" : "string",
                                    "example" : "was not allowed"
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "400" : {
                    "description" : "invalid input, object invalid"
                  },
                  "500" : {
                    "description" : "error with allowing domains or ips"
                  }
                }
              }
            },
            "/testing/update" : {
              "post" : {
                "tags" : [ "Testing State Management" ],
                "summary" : "Update a VM or group",
                "operationId" : "update",
                "description" : "Runs the ansible update routine on a VM or group of VMs specified\nby the user in the request body. (Windows only)\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to act on behalf of. Only admins can provide userIDs that are not their own.\n",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "requestBody" : {
                  "content" : {
                    "application/json" : {
                      "schema" : {
                        "type" : "object",
                        "properties" : {
                          "name" : {
                            "type" : "string",
                            "example" : "JD-win10-21h2-enterprise-x64"
                          }
                        }
                      }
                    }
                  },
                  "description" : "VM name or group name to update"
                },
                "responses" : {
                  "200" : {
                    "description" : "VM update process started",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "update process started"
                            }
                          }
                        }
                      }
                    }
                  },
                  "500" : {
                    "description" : "error starting update process"
                  }
                }
              }
            },
            "/templates" : {
              "get" : {
                "tags" : [ "Template Management" ],
                "summary" : "Retrieve a list of VM templates",
                "operationId" : "getTemplates",
                "description" : "Returns a list of VM templates that have been built in Ludus. These\ntemplates can be used in a range config and deployed via Ludus.\n",
                "responses" : {
                  "200" : {
                    "description" : "template status array",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "array",
                          "items" : {
                            "type" : "object",
                            "properties" : {
                              "name" : {
                                "type" : "string",
                                "example" : "debian-11-x64-server-template"
                              },
                              "built" : {
                                "type" : "boolean",
                                "example" : false
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "500" : {
                    "description" : "error getting templates"
                  }
                }
              },
              "post" : {
                "tags" : [ "Template Management" ],
                "summary" : "Build templates",
                "operationId" : "buildTemplates",
                "description" : "Starts the packer template build process. Monitor with the templates/log\nendpoint. Specify a specific template or 'all'.\n",
                "requestBody" : {
                  "content" : {
                    "application/json" : {
                      "schema" : {
                        "properties" : {
                          "template" : {
                            "type" : "string",
                            "example" : "debian-12-x64-server-template"
                          },
                          "parallel" : {
                            "type" : "integer",
                            "example" : 3
                          },
                          "verbose" : {
                            "type" : "boolean",
                            "example" : false
                          }
                        }
                      }
                    }
                  }
                },
                "responses" : {
                  "200" : {
                    "description" : "template builds started",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "Template building started - this will take a while. Building 3 template(s) at a time."
                            }
                          }
                        }
                      }
                    }
                  },
                  "404" : {
                    "description" : "Template not found",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "error" : {
                              "type" : "string",
                              "example" : "Template not found"
                            }
                          }
                        }
                      }
                    }
                  },
                  "500" : {
                    "description" : "error starting template build"
                  }
                }
              },
              "put" : {
                "tags" : [ "Template Management" ],
                "summary" : "Install an Ansible role from local directory",
                "operationId" : "addTemplateFromTar",
                "description" : "Add a template to ludus\n",
                "requestBody" : {
                  "content" : {
                    "multipart/form-data" : {
                      "schema" : {
                        "type" : "object",
                        "properties" : {
                          "file" : {
                            "type" : "string",
                            "format" : "binary"
                          },
                          "force" : {
                            "type" : "boolean",
                            "example" : false
                          }
                        }
                      }
                    }
                  }
                },
                "responses" : {
                  "201" : {
                    "description" : "template added",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "Successfully added template"
                            }
                          }
                        }
                      }
                    }
                  },
                  "400" : {
                    "description" : "Error adding template - bad request",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "error" : {
                              "type" : "string",
                              "example" : "Invalid boolean value"
                            }
                          }
                        }
                      }
                    }
                  },
                  "500" : {
                    "description" : "Error adding template - server error",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "error" : {
                              "type" : "string",
                              "example" : "Unable to add the template: <error>"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/template/{name}" : {
              "delete" : {
                "tags" : [ "Template Management" ],
                "summary" : "Delete a template",
                "operationId" : "deleteTemplate",
                "description" : "Delete a template. Users may not delete system templates.",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to impersonate a user (admins only)",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                }, {
                  "name" : "name",
                  "in" : "path",
                  "required" : true,
                  "description" : "The name of the template to delete",
                  "schema" : {
                    "properties" : {
                      "templateName" : {
                        "type" : "string",
                        "example" : "ubuntu-22.04-x64-server"
                      }
                    }
                  }
                } ],
                "responses" : {
                  "201" : {
                    "description" : "Template removed",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "Template removed"
                            }
                          }
                        }
                      }
                    }
                  },
                  "400" : {
                    "description" : "Bad request",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "error" : {
                              "type" : "string",
                              "example" : "Template name not provided"
                            }
                          }
                        }
                      }
                    }
                  },
                  "403" : {
                    "description" : "Access denied",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "error" : {
                              "type" : "string",
                              "example" : "Access denied. Users are not allowed to delete system templates"
                            }
                          }
                        }
                      }
                    }
                  },
                  "404" : {
                    "description" : "Template not found",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "error" : {
                              "type" : "string",
                              "example" : "Template not found"
                            }
                          }
                        }
                      }
                    }
                  },
                  "409" : {
                    "description" : "Template conflict",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "error" : {
                              "type" : "string",
                              "example" : "Error removing template, it is in use by VMs"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/templates/abort" : {
              "post" : {
                "tags" : [ "Template Management" ],
                "summary" : "Kill packer processes for user",
                "operationId" : "abortTemplates",
                "description" : "Kills any running packer processes for the user,\nor the user given in the query string (admin only).\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "Pass an optional userID to kill packer processes for. \nDefaults to the user's range (admins can interact with other users' ranges)\n",
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                } ],
                "responses" : {
                  "200" : {
                    "description" : "Packer processes killed",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "Packer process(es) aborted for user john-doe"
                            }
                          }
                        }
                      }
                    }
                  },
                  "500" : {
                    "description" : "error starting template build",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "error" : {
                              "type" : "string",
                              "example" : "No packer processes found for user john-doe"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/templates/logs" : {
              "get" : {
                "tags" : [ "Template Management" ],
                "summary" : "Retrieve the latest packer logs",
                "operationId" : "getPackerLogs",
                "description" : "Returns the latest logs from packer\n",
                "parameters" : [ {
                  "in" : "query",
                  "name" : "userID",
                  "description" : "pass an optional userID to get the logs for. \nDefaults to the user's range (admins can query other ranges)\n",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "userID" : {
                        "$ref" : "#/components/schemas/userID"
                      }
                    }
                  }
                }, {
                  "in" : "query",
                  "name" : "tail",
                  "description" : "pass an optional number of lines to get\n",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "tail" : {
                        "type" : "integer",
                        "example" : 100
                      }
                    }
                  }
                }, {
                  "in" : "query",
                  "name" : "cursor",
                  "description" : "the line number of the last line presented to the user;\nreturn lines starting at the next line (if any)\n",
                  "required" : false,
                  "schema" : {
                    "properties" : {
                      "resumeline" : {
                        "type" : "integer",
                        "example" : 274
                      }
                    }
                  }
                } ],
                "responses" : {
                  "200" : {
                    "description" : "packer logs for the user and a cursor values of the last line returned",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "object",
                          "properties" : {
                            "result" : {
                              "type" : "string",
                              "example" : "2023/01/29 14:57:40 Build debug mode: false\n2023/01/29 14:57:40 Force build: false\n2023/01/29 14:57:40 On error: abort\n2023/01/29 14:57:40 Waiting on builds to complete...\n2023/01/29 14:57:40 Starting build run: proxmox.debian10\n2023/01/29 14:57:40 Running builder: \n2023/01/29 14:57:40 [INFO] (telemetry) Starting builder proxmox.debian10\n2023/01/29 14:57:40 packer-builder-proxmox plugin: using password auth\n...\n"
                            },
                            "cursor" : {
                              "type" : "integer",
                              "example" : 274
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/templates/status" : {
              "get" : {
                "tags" : [ "Template Management" ],
                "summary" : "Get the status of packer builds",
                "operationId" : "getTemplatesStatus",
                "description" : "Returns a list of templates that are currently being built\n",
                "responses" : {
                  "200" : {
                    "description" : "array of templates being built and the users who initiated the builds",
                    "content" : {
                      "application/json" : {
                        "schema" : {
                          "type" : "array",
                          "items" : {
                            "type" : "object",
                            "properties" : {
                              "template" : {
                                "type" : "string",
                                "example" : "debian-10-x64-server-template"
                              },
                              "user" : {
                                "type" : "string",
                                "example" : "john-doe"
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "500" : {
                    "description" : "error getting templates status"
                  }
                }
              }
            }
          },
          "components" : {
            "securitySchemes" : {
              "ApiKeyAuth" : {
                "type" : "apiKey",
                "in" : "header",
                "name" : "X-API-KEY"
              }
            },
            "schemas" : {
              "userID" : {
                "type" : "string",
                "example" : "JD",
                "pattern" : "^[A-Za-z0-9]{1,20}$",
                "description" : "Must be a unique 1-20 character alpha-numeric string.\nInitials are commonly used.\n"
              },
              "UserObject" : {
                "type" : "object",
                "required" : [ "name", "userID", "dateCreated", "dateLastActive", "isAdmin", "encryptedAPIKey", "proxmoxUsername" ],
                "properties" : {
                  "name" : {
                    "type" : "string",
                    "example" : "John Doe"
                  },
                  "userID" : {
                    "$ref" : "#/components/schemas/userID"
                  },
                  "dateCreated" : {
                    "type" : "string",
                    "format" : "date-time",
                    "example" : "2022-08-29T09:12:33.001Z",
                    "readOnly" : true
                  },
                  "dateLastActive" : {
                    "type" : "string",
                    "format" : "date-time",
                    "example" : "2022-08-29T09:12:33.001Z",
                    "readOnly" : true
                  },
                  "isAdmin" : {
                    "type" : "boolean",
                    "example" : true
                  },
                  "proxmoxUsername" : {
                    "type" : "string",
                    "example" : "john-doe",
                    "readOnly" : true
                  }
                }
              },
              "UserAPIKeyObject" : {
                "type" : "object",
                "properties" : {
                  "apiKey" : {
                    "type" : "string",
                    "pattern" : "^[a-zA-Z0-9!@#%^&*()_+\\-=\\[\\]{}:\\\\|<>\\/?]{40}$",
                    "example" : "G0rO+G+8Zlu%CAEDyYC2ZdW3pBWW+al,J2_tli1h",
                    "readOnly" : true
                  }
                }
              },
              "UserCredentialObject" : {
                "example" : {
                  "proxmoxPassword" : "5cy5@plhik4g&Yk12sG",
                  "proxmoxUsername" : "john-doe"
                },
                "properties" : {
                  "proxmoxUsername" : {
                    "example" : "john-doe",
                    "readOnly" : true,
                    "type" : "string"
                  },
                  "proxmoxPassword" : {
                    "example" : "5cy5@plhik4g&Yk12sG",
                    "readOnly" : true,
                    "type" : "string"
                  }
                },
                "type" : "object"
              },
              "RangeObject" : {
                "type" : "object",
                "required" : [ "userID", "rangeNumber", "lastDeployment", "numberOfVMs", "testingEnabled", "VMs" ],
                "properties" : {
                  "userID" : {
                    "$ref" : "#/components/schemas/userID"
                  },
                  "rangeNumber" : {
                    "type" : "integer",
                    "format" : "int32",
                    "example" : 3,
                    "readOnly" : true
                  },
                  "lastDeployment" : {
                    "type" : "string",
                    "format" : "date-time",
                    "example" : "2022-08-29T09:12:33.001Z",
                    "readOnly" : true
                  },
                  "numberOfVMs" : {
                    "type" : "integer",
                    "format" : "int32",
                    "example" : 7,
                    "readOnly" : true
                  },
                  "testingEnabled" : {
                    "type" : "boolean",
                    "example" : true,
                    "readOnly" : true
                  },
                  "allowedIPs" : {
                    "type" : "array",
                    "items" : {
                      "type" : "string",
                      "example" : "1.2.3.4"
                    }
                  },
                  "allowedDomains" : {
                    "type" : "array",
                    "items" : {
                      "type" : "string",
                      "example" : "example.com"
                    }
                  },
                  "VMs" : {
                    "type" : "array",
                    "items" : {
                      "$ref" : "#/components/schemas/VMObject"
                    }
                  }
                }
              },
              "VMObject" : {
                "type" : "object",
                "required" : [ "ID", "proxmoxID", "rangeNumber", "name", "poweredOn" ],
                "properties" : {
                  "ID" : {
                    "type" : "integer",
                    "format" : "int32",
                    "example" : 53,
                    "readOnly" : true
                  },
                  "proxmoxID" : {
                    "type" : "integer",
                    "format" : "int32",
                    "example" : 146,
                    "readOnly" : true
                  },
                  "rangeNumber" : {
                    "type" : "integer",
                    "format" : "int32",
                    "example" : 3,
                    "readOnly" : true
                  },
                  "name" : {
                    "type" : "string",
                    "example" : "JD-ad-dc-win2019-server-x64"
                  },
                  "poweredOn" : {
                    "type" : "boolean",
                    "example" : true
                  },
                  "ip" : {
                    "$ref" : "#/components/schemas/IP"
                  }
                }
              },
              "Domain" : {
                "type" : "string",
                "pattern" : "^(?!.*?_.*?)(?!(?:[\\d\\w]+?\\.)?\\-[\\w\\d\\.\\-]*?)(?![\\w\\d]+?\\-\\.(?:[\\d\\w\\.\\-]+?))(?=[\\w\\d])(?=[\\w\\d\\.\\-]*?\\.+[\\w\\d\\.\\-]*?)(?![\\w\\d\\.\\-]{254})(?!(?:\\.?[\\w\\d\\-\\.]*?[\\w\\d\\-]{64,}\\.)+?)[\\w\\d\\.\\-]+?(?<![\\w\\d\\-\\.]*?\\.[\\d]+?)(?<=[\\w\\d\\-]{2,})(?<![\\w\\d\\-]{25})$",
                "description" : "A domain to allow during testing (along with HTTPS CRL domains)",
                "example" : "example.com"
              },
              "IP" : {
                "type" : "string",
                "pattern" : "^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$",
                "example" : "203.0.113.4"
              },
              "AllowPayload" : {
                "type" : "object",
                "properties" : {
                  "domains" : {
                    "type" : "array",
                    "items" : {
                      "$ref" : "#/components/schemas/Domain"
                    }
                  },
                  "ips" : {
                    "type" : "array",
                    "items" : {
                      "$ref" : "#/components/schemas/IP"
                    }
                  }
                }
              }
            }
          },
          "servers" : [ {
            "description" : "Public DNS that resolves to 198.51.100.1",
            "url" : "https://my.ludus.cloud:8080"
          } ]
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"></script>
  </body>
</html>
